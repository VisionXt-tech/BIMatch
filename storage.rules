
rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Regola generale: nega la lettura e la scrittura a tutti per default
    // per evitare accessi non autorizzati a percorsi non specificati.
    match /{allPaths=**} {
      allow read, write: if false;
    }

    // Logo Aziendali: Chiunque può leggerli (per visualizzarli pubblicamente).
    // Solo l'utente autenticato (azienda) può scrivere (caricare/aggiornare)
    // il proprio logo, e solo se il file è un'immagine e di dimensioni contenute.
    match /companyLogos/{userId}/{fileName} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == userId
                   && request.resource.size < 2 * 1024 * 1024 // Max 2MB
                   && request.resource.contentType.matches('image/.*');
    }

    // Immagini Profilo Professionisti: Chiunque può leggerle.
    // Solo l'utente autenticato (professionista) può scrivere la propria immagine.
    match /profileImages/{userId}/{fileName} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.uid == userId
                   && request.resource.size < 2 * 1024 * 1024 // Max 2MB
                   && request.resource.contentType.matches('image/.*');
    }

    // Certificazioni PDF dei Professionisti:
    // Solo l'utente autenticato (professionista) può scrivere i propri PDF.
    // Chiunque può leggerli, poiché i link sono condivisi nei profili pubblici.
    match /professionalCertifications/{path=**}/{userId}/{fileName} {
       allow read: if true;
       allow write: if request.auth != null && request.auth.uid == userId
                    && request.resource.size < 5 * 1024 * 1024 // Max 5MB
                    && request.resource.contentType == 'application/pdf';
    }
  }
}
